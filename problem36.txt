pのメモリが解放されていないことが原因だが、今のコードだとpを適切にfreeするタイミングがない。

